<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Double Pendulum Plot</title>

    <link rel="stylesheet" type="text/css" href="style.css">

    <script src="libraries/p5.min.js"></script>
    <script src="libraries/p5.sound.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
  </head>

  <body>
    <h1>Double pendulum plot!</h1>
    <strong><p>Scroll down fully to view the simulation</p>
    <p>You may have to wait a bit for the pendulums to diverge before the lines start appearing</p>
    <p>Open DevTools (f12) to view time taken for each frame (miliseconds). Each frame will print one line.</p>
    <p>Press S to save<p>
    <p><strong>Double click to view the pendulum in a new tab</strong></p>
    </strong>
    <h2>Please scroll down a bit and enable RK4 then click "update parameters"</h2>
    <h2>Also, switching tabs may cause the simulation to show random stuff with DeltaTime</h2>
    
    <button onclick="window.scrollTo(0, document.body.scrollHeight);">Scroll to simulation</button>
    <script src="sketch.js"></script>
    <p>Source code:</p> 
    <a href="https://github.com/itzmetanjim/double-pendulum">https://github.com/itzmetanjim/double-pendulum</a>
    <p>You can find many extra screenshots and images there.</p>
    <p>Parameters:</p>
    <p>Canvas size in pixels: <input type="text" id="csize" placeholder="600"></input></p>
    <p class="subtle">Reduce to make plot faster. If you enabled deltaTime, reducing this will make it more accurate (for the plotted values)</p>
    <p>Damping factor:<input type="text" id="damp" placeholder="1"></input></p>
    <p class="subtle">0 to 1, example: 0.999. The velocities get multiplied by this every tick</p>
    <p>DeltaTime enabled? <input type="text" id="deltaTime" placeholder="no"></input></p>
    <p class="subtle">If true, the simulation will use deltatime. This may make the viewing experience better, but it also may make it less accurate for laggier PCs.</p>
    <p>Time step: <input type="text" id="timeStep" placeholder="1"></input></p>
    <p class="subtle">The time step. If deltaTime is enabled it will be multiplied by deltatime.</p>
    <p>Use RK4: <input type="text" id="rk4" placeholder="false"></input></p>
    <p class="subtle">If true, this will use a more accurate 4th order Runge Kutta simulation (RK4).</p>
    <p class="subtle">If false, it will use the simpler and faster but less accurate Euler simulation.</p>
    <p class="subtle">RK4 is way slower than Eulerian, but it is more accurate.There are minor differences between the outputs, especially in the top-right and bottom-left corners.</p>
    <p class="subtle">DeltaTime may make RK4 less accurate than Eulerian if enabled.</p>
    <p class="subtle"><strong>It's recommended to try RK4 first.</strong></p>

    <h3>Physical Parameters:</h3>
    <p>Gravity (g): <input type="text" id="g" placeholder="10"></input></p>
    <p class="subtle">Gravitational acceleration. Default: 10</p>
    <p>Length 1 (l1): <input type="text" id="l1" placeholder="100"></input></p>
    <p class="subtle">Length of the top pendulum arm. Default: 100</p>
    <p>Length 2 (l2): <input type="text" id="l2" placeholder="100"></input></p>
    <p class="subtle">Length of the bottom pendulum arm. Default: 100</p>
    <p>Mass 1 (m1): <input type="text" id="m1" placeholder="10"></input></p>
    <p class="subtle">Mass of the top pendulum bob. Default: 10</p>
    <p>Mass 2 (m2): <input type="text" id="m2" placeholder="10"></input></p>
    <p class="subtle">Mass of the bottom pendulum bob. Default: 10</p>

    <p>Color channel types (red, green, blue, alpha): <input type="text" id="ctype" placeholder="avg,avg,avg,full"></input></p>
    <p class="subtle">Use to modify the plot variables</p>
    <p class="subtle">Color channel types can be specified to generate custom plots</p>
    <button onclick="window.scrollTo(0, document.body.scrollHeight);">Scroll to simulation</button>&nbsp; 
     <button onclick="updateParameters()">Update Parameters</button>
    <p>After (a lot of) some time, the result should approach something like this:</p>
    <a href="example.png" target="_blank">Click here for image</a>
    <p>You will see that most stable pendulums are in this big region near the center as well as smaller "islands of stability" near it that are disjoint from the main one</p>
    <p>For a video explaining what this is (along with more interesting stuff and more graphs), check this out:</p>
    <a href="https://www.youtube.com/watch?v=dtjb2OhEQcU">Video link</a>
    <h2>Color channel string info</h2>
    <p>The color channel types string should be in the format: <code>[red],[green],[blue],[alpha]</code></p>
    <p>where <code>[red],[green],[blue],[alpha]</code> are in:</p>
    <ul>
      <li><code>avg</code>: Average of top angle divergence and bottom angle divergence</li>
      <li><code>a1</code>: Top angle divergence</li>
      <li><code>a2</code>: Bottom angle divergence</li>
      <li><code>max</code>: Maximum of top angle divergence and bottom angle divergence</li>
      <li><code>min</code>: Minimum of top angle divergence and bottom angle divergence</li>
      <li><code>zero</code>: Channel value set to 0</li>
      <li><code>full</code>: Channel value set to 255</li>
      <li><code>[number]</code>: Any constant integer value between 0 and 255</li>
    </ul>
    <button onclick="updateParameters()">Update Parameters</button> <br>
    <button onclick="window.scrollTo(0, document.body.scrollHeight);">Scroll to simulation</button>
    <br>
    <br>
    <p>You may have to wait a bit for the pendulums to diverge before the lines start appearing</p>
    Press S to save<br>
    <strong>Double click to view the pendulum in a new tab</strong><br>
    Open DevTools (f12) to view time taken for each frame (miliseconds). Each frame will print one line.<br>
    <p><strong>Plot</strong></p>
    <script>
      let csize_in = document.getElementById("csize");
      let damp_in = document.getElementById("damp");
      let ctype_in = document.getElementById("ctype");
      let deltaTime_in = document.getElementById("deltaTime");
      let timeStep_in = document.getElementById("timeStep");
      let rk4_in = document.getElementById("rk4");
      let g_in = document.getElementById("g");
      let l1_in = document.getElementById("l1");
      let l2_in = document.getElementById("l2");
      let m1_in = document.getElementById("m1");
      let m2_in = document.getElementById("m2");
      
      rk4_in.value = new URL(window.location.href).searchParams.get('rk4') || "";
      deltaTime_in.value = new URL(window.location.href).searchParams.get('deltaTime')
      timeStep_in.value = new URL(window.location.href).searchParams.get('timeStep') || "1";
      csize_in.value = new URL(window.location.href).searchParams.get('canvasSize') || "600";
      damp_in.value = new URL(window.location.href).searchParams.get('damp') || "0.999";
      ctype_in.value = new URL(window.location.href).searchParams.get('type') || "avg,avg,avg,full";
      g_in.value = new URL(window.location.href).searchParams.get('g') || "10";
      l1_in.value = new URL(window.location.href).searchParams.get('l1') || "100";
      l2_in.value = new URL(window.location.href).searchParams.get('l2') || "100";
      m1_in.value = new URL(window.location.href).searchParams.get('m1') || "10";
      m2_in.value = new URL(window.location.href).searchParams.get('m2') || "10";
      
      function updateParameters() {
        const csize = document.getElementById("csize").value;
        const damp = document.getElementById("damp").value;
        const ctype = document.getElementById("ctype").value;
        const deltaTime = document.getElementById("deltaTime").value;
        const timeStep = document.getElementById("timeStep").value;
        const rk4 = document.getElementById("rk4").value;
        const g = document.getElementById("g").value;
        const l1 = document.getElementById("l1").value;
        const l2 = document.getElementById("l2").value;
        const m1 = document.getElementById("m1").value;
        const m2 = document.getElementById("m2").value;

        var url = new URL(window.location.href);
        url.searchParams.set('canvasSize', csize);
        url.searchParams.set('damp', damp);
        url.searchParams.set('type', ctype);
        if (deltaTime.toLowerCase() === "yes" || deltaTime.toLowerCase() === "true") {
          url.searchParams.set('deltaTime', 'true');
        } //else set it to nothing
        if (rk4.toLowerCase() === "yes" || rk4.toLowerCase() === "true") {
          url.searchParams.set('rk4', 'true');
        } 
        if (timeStep !== "") {
          url.searchParams.set('timeStep', timeStep);
        }
        if (g !== "") {
          url.searchParams.set('g', g);
        }
        if (l1 !== "") {
          url.searchParams.set('l1', l1);
        }
        if (l2 !== "") {
          url.searchParams.set('l2', l2);
        }
        if (m1 !== "") {
          url.searchParams.set('m1', m1);
        }
        if (m2 !== "") {
          url.searchParams.set('m2', m2);
        }
        //redirect!
        window.location.href = url.href;
      }
      
    </script>

  </body>
</html>